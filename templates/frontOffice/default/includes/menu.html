<section class="block block-nav" id="categories" aria-labelledby="categories-label" role="navigation">
    <div class="block-heading"><h3 class="block-title" id="categories-label">{intl l="Categories"}</h3></div>
    <div class="block-content">
        <nav class="nav-categories">
            {* define current ID *}
            {loop name="current_cat" type="category" current="yes"}
                {assign var="current_category_id" value="{$PARENT}"}
            {/loop}
            {* define the function *}
            {function menu level=0}
            {if $level == 0}<ul class="accordion" id="category">
            {else}<ul class="{if $parent == $current_category_id}in{else}collapse{/if}" id="collapse{$parent}">{/if}
            {loop name="cat-parent-$level" type="category" parent=$parent need_count_child=1}
                {if $CHILD_COUNT> 0}
                <li>
                    <a class="accordion-toggle collapsed" data-toggle="collapse" data-parent="#collapse{$ID}" href="{$URL}#collapse{$ID}">{$TITLE}</a>
                    {menu parent=$ID level=$level+1}
                </li>
                {else}<li><a href="{$URL}">{$TITLE} ({count type="product" category="{$ID}"})</a></li>{/if}
            {/loop}
            </ul>
            {/function}
            {menu parent='0'}
        </nav>
    </div>
</section>
